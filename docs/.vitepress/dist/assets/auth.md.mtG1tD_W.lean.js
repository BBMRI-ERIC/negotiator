import{_ as t,c as o,a3 as a,o as n}from"./chunks/framework.D6X87co3.js";const r="/auth-code.png",p=JSON.parse('{"title":"Authentication and authorization","description":"","frontmatter":{},"headers":[],"relativePath":"auth.md","filePath":"auth.md","lastUpdated":1751450357000}'),s={name:"auth.md"};function i(l,e,h,c,d,u){return n(),o("div",null,e[0]||(e[0]=[a('<h1 id="authentication-and-authorization" tabindex="-1">Authentication and authorization <a class="header-anchor" href="#authentication-and-authorization" aria-label="Permalink to &quot;Authentication and authorization&quot;">​</a></h1><p>The Negotiator (both backend and frontend) uses <a href="https://oauth.net/2/" target="_blank" rel="noreferrer">OAuth 2.0</a> and <a href="https://openid.net/connect/" target="_blank" rel="noreferrer">OpenID Connect (OIDC)</a> for secure authentication and authorization. These protocols ensure that only authorized users and systems can access the resources provided by the Negotiator. The system supports <strong>Authorization Code Flow</strong> for user authentication and <strong>Client Credentials Flow</strong> for machine-to-machine communication, allowing seamless integration in both interactive and automated scenarios.</p><h2 id="authorization-code-flow-frontend" tabindex="-1">Authorization Code Flow (Frontend) <a class="header-anchor" href="#authorization-code-flow-frontend" aria-label="Permalink to &quot;Authorization Code Flow (Frontend)&quot;">​</a></h2><p>For user authentication, the frontend of the Negotiator uses the * *<a href="https://oauth.net/2/grant-types/authorization-code/" target="_blank" rel="noreferrer">Authorization Code Flow</a>**, which is ideal for scenarios where a user needs to log in via a third-party identity provider (such as <a href="https://www.keycloak.org/" target="_blank" rel="noreferrer">Keycloak</a>, <a href="https://developers.google.com/identity" target="_blank" rel="noreferrer">Google</a>, or <a href="https://docs.github.com/en/free-pro-team@latest/developers/apps/building-oauth-apps/creating-an-oauth-app" target="_blank" rel="noreferrer">GitHub</a>). In this flow, the frontend application requests the user to authenticate with an authorization server, typically a trusted identity provider. The flow works as follows: <img src="'+r+'" alt="Diagram"> Credit for this diagram goes to <a href="https://auth0.com/docs/get-started/authentication-and-authorization-flow/authorization-code-flow-with-pkce" target="_blank" rel="noreferrer">Auth0</a></p><ol><li>The frontend redirects the user to the OIDC provider (the authorization server) for authentication.</li><li>After the user successfully logs in, the OIDC provider redirects the user back to the frontend with an * <em>authorization code</em>*.</li><li>The frontend exchanges the authorization code for an <strong>access token</strong> and, optionally, a <strong>refresh token</strong>, which can then be used to make authenticated API requests.</li></ol><p>This flow is secure because the access token is never exposed to the user agent (browser), mitigating potential security risks. To retrieve additional user details, both the frontend and the backend call the <strong><a href="https://openid.net/specs/openid-connect-core-1_0.html#UserInfoEndpoint" target="_blank" rel="noreferrer">UserInfo endpoint</a></strong>, which returns a JSON object containing various claims about the authenticated user. These claims can include information like email, name, roles, and custom attributes, which are essential for fine-grained authorization decisions.</p><p>Once the backend receives the <em><strong>userinfo</strong></em> response, it parses the user&#39;s claims to make authorization decisions. The roles and permissions assigned to a user are often based on specific claims returned in the <strong><em>userinfo</em></strong> response. For instance, in the Negotiator platform, users may be assigned roles such as <strong>RESEARCHER</strong>, <strong>ADMIN</strong>, or <strong>REPRESENTATIVE</strong> based on values found in a claim like <strong><em>eduperson_entitlement</em></strong>.</p><p>For example:</p><ul><li>If the <em>eduperson_entitlement</em> claim contains the value <strong>RESEARCHER</strong>, the user is granted the <strong>RESEARCHER</strong> role.</li><li>Similarly, if the claim contains <strong>ADMIN</strong>, the user is granted the <strong>ADMIN</strong> role, and so on.</li></ul><p>The values in the <em>eduperson_entitlement</em> claim (or any other claim) are fully customizable to suit the needs of your application. You can define roles and permissions according to your organization&#39;s policies by mapping specific claim values to roles in your system. The mapping can be customized in the <a href="https://github.com/BBMRI-ERIC/negotiator/blob/master/backend/src/main/resources/application.yaml" target="_blank" rel="noreferrer">application.yml file</a>. or via environment variables.</p><p>This flexibility allows the Negotiator platform to adapt to various authorization schemes and ensures that users only have access to resources and actions they are authorized to interact with.</p><p>For more information about how roles and claims are handled in OIDC, see the <strong><a href="https://openid.net/specs/openid-connect-core-1_0.html" target="_blank" rel="noreferrer">OpenID Connect Core 1.0</a></strong> specification.</p><h2 id="client-credentials-flow-backend-external-systems" tabindex="-1">Client Credentials Flow (Backend / External Systems) <a class="header-anchor" href="#client-credentials-flow-backend-external-systems" aria-label="Permalink to &quot;Client Credentials Flow (Backend / External Systems)&quot;">​</a></h2><p>The <strong><a href="https://oauth.net/2/grant-types/client-credentials/" target="_blank" rel="noreferrer">Client Credentials Flow</a></strong> is used when an external system or a script needs to authenticate with the Negotiator backend without user involvement. This flow is typically used for machine-to-machine interactions, such as when a script or a third-party service needs to access protected resources or make API calls on behalf of a system (not a user). Here&#39;s how it works in a typical scenario:</p><ol><li><p>An external system, like a script or an automation tool, needs to access data or perform operations within the Negotiator backend. To do this, the system first obtains its <strong>client ID</strong> and <strong>client secret</strong> from the OIDC provider (e.g., <a href="https://www.keycloak.org/" target="_blank" rel="noreferrer">Keycloak</a>).</p></li><li><p>The system sends a request to the OIDC authorization server&#39;s token endpoint, passing its client credentials (client ID and secret) to obtain an <strong>access token</strong>. This request does not involve any user authentication, as it is intended for machine-level access.</p></li><li><p>The OIDC provider responds with an <strong>access token</strong> that the external system can use to authenticate API requests to the Negotiator backend. The token is typically short-lived, and the system can request a new token using its client credentials once it expires.</p></li></ol><p>For example, consider a script running on a server that needs to periodically pull data from the Negotiator backend ( e.g., to collect usage metrics or sync data with another system). Using the Client Credentials Flow, the script will authenticate against the OIDC provider, obtain an access token, and use it to make API calls to the backend, all without requiring user interaction.</p><p>This flow is ideal for automating tasks or integrating external systems that need access to the Negotiator&#39;s resources in a secure and controlled manner.</p><h2 id="token-validation-backend" tabindex="-1">Token Validation (Backend) <a class="header-anchor" href="#token-validation-backend" aria-label="Permalink to &quot;Token Validation (Backend)&quot;">​</a></h2><p>Once the frontend or an external system obtains an access token using either the Authorization Code Flow or the Client Credentials Flow, the backend of the Negotiator performs <strong>token validation</strong> before granting access to protected resources. The backend validates the token by checking the following:</p><ol><li><p><strong>Signature</strong>: The backend verifies that the token&#39;s signature is valid and was issued by a trusted OIDC provider ( authorization server). This ensures that the token has not been tampered with. The signature verification process typically uses the <strong><a href="https://jwt.io/" target="_blank" rel="noreferrer">JWT</a> (JSON Web Token)</strong> standard, which defines how to create and verify the signature of tokens.</p></li><li><p><strong>Timestamp</strong>: The backend checks the token&#39;s <strong>exp</strong> (expiration) claim to ensure the token is not expired. The backend may also verify the <strong>nbf</strong> (not before) claim to ensure the token is being used within the valid time frame. These claims help ensure that the token is still valid at the time of usage. For more information on these claims, refer to the <strong><a href="https://datatracker.ietf.org/doc/html/rfc7519#section-4.1" target="_blank" rel="noreferrer">JWT Claims</a></strong> specification.</p></li><li><p><strong>Audiences</strong>: The backend validates the <strong>aud</strong> (audience) claim to ensure the token is intended for use with the Negotiator backend and not for some other service. The <strong>aud</strong> claim is used to specify the intended audience for the token. If the audience doesn&#39;t match, the token is rejected. For more details on audience validation, see the * <em><a href="https://datatracker.ietf.org/doc/html/rfc7519#section-4.1.3" target="_blank" rel="noreferrer">JWT Audience Claim</a></em>* specification.</p></li><li><p><strong>Introspection (Optional)</strong>: <strong><a href="https://tools.ietf.org/html/rfc7662" target="_blank" rel="noreferrer">Token Introspection</a></strong> is an optional but highly recommended method for further validating the token. In this step, the backend can send a request to the OIDC provider&#39;s introspection endpoint to check if the token is still active and valid. This can help detect if the token has been revoked or is otherwise invalid, offering an additional layer of security. Introspection provides real-time information about the token&#39;s status and additional metadata (like its scopes and associated user info).</p></li></ol><p>While the first three steps (signature, timestamp, and audiences) are mandatory, <strong>token introspection</strong> provides extra assurance and can be enabled based on the security requirements of the environment.</p><h2 id="authorization" tabindex="-1">Authorization <a class="header-anchor" href="#authorization" aria-label="Permalink to &quot;Authorization&quot;">​</a></h2><p>In this seciton the roles supported by the Negotiator are described. Unless stated otherwise, these roles are assigned through mapping values in a specific scope as stated above.</p><h3 id="basic-user-roles" tabindex="-1">Basic user roles <a class="header-anchor" href="#basic-user-roles" aria-label="Permalink to &quot;Basic user roles&quot;">​</a></h3><ul><li><strong>RESEARCHER</strong>: The most basic role each user is granted. It allows the user to create Negotiations and interact with them.</li><li><strong>REPRESENTATIVE</strong>: A user responsible for mediating access to a given resource. It allows them interacting with relevant Negotiations.</li><li><strong>NETWORK MANAGER</strong>: A user responsible for moderating access to a group of resources. Grants them access to monitoring functionalities over relevant Negotiations.</li></ul><h3 id="special-roles" tabindex="-1">Special roles <a class="header-anchor" href="#special-roles" aria-label="Permalink to &quot;Special roles&quot;">​</a></h3><ul><li><strong>ADMIN</strong>: Administrator over the entire instance.</li><li><strong>RESOURCE MANAGER</strong>: Grants access to modify all available resources. Assigned to the user if the token contains scope <em><strong>negotiator_resource_management</strong></em>.</li><li><strong>AUTH MANAGER</strong>: Grants access to modify assigned representatives and network managers. Assigned to the user if the token contains scope <em><strong>negotiator_authz_management</strong></em>.</li><li><strong>PROMETHEUS</strong>: Grants access to metrics endpoints. Assigned to the user if the token contains scope <em><strong>negotiator_monitoring</strong></em>.</li></ul>',27)]))}const m=t(s,[["render",i]]);export{p as __pageData,m as default};
